<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Лидерборд</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
body{margin:0;padding:20px;font-family:'Orbitron',sans-serif;background:#0b0c10;color:#00f0ff;display:flex;flex-direction:column;align-items:center;}
h1{font-size:2.5em;text-shadow:0 0 10px #00f0ff;margin-bottom:20px;}
#board{width:95%;max-width:900px;display:flex;flex-direction:column;gap:12px;}
.row{display:grid;grid-template-columns:50px 2fr 80px 120px;padding:12px;border-radius:10px;background:rgba(0,0,0,0.55);border:1px solid rgba(0,255,255,0.2);box-shadow:0 2px 10px rgba(0,255,255,0.2);align-items:center;transition:all 0.3s;opacity:0;transform:translateY(-20px);}
.row.show{opacity:1;transform:translateY(0);}
.row.current{background:rgba(0,128,255,0.45);}
.rank{text-align:center;}
.nick{}
.points{text-align:center;}
.role{text-align:center;color:#0ff;}
</style>
</head>
<body>
<h1>Лидерборд</h1>
<div id="board"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB7QbVxGHR7Qm8o8Wzl_wxsCpzMUdS5rws",
  authDomain: "gdboard-add4a.firebaseapp.com",
  projectId: "gdboard-add4a",
  storageBucket: "gdboard-add4a.appspot.com",
  messagingSenderId: "883125028740",
  appId: "1:883125028740:web:c504de4139943b8606bfd1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const board=document.getElementById('board');

onAuthStateChanged(auth, async user=>{
  if(!user) return window.location.href='index.html';
  const usersRef=collection(db,'users');
  const q=query(usersRef,orderBy('points','desc'));
  const snapshot=await getDocs(q);
  const usersArr=snapshot.docs.map(d=>({id:d.id,...d.data()}));

  // подсчет мест с одинаковыми баллами
  let place=1, lastPoints=null, samePlace=1;
  usersArr.forEach((u,i)=>{
    const p=u.points||0;
    if(lastPoints!==null && p<lastPoints){ place=i+1; samePlace=place;}
    u.displayPlace=samePlace;
    lastPoints=p;
  });

  usersArr.forEach((u,index)=>{
    const row=document.createElement('div');
    row.classList.add('row');
    if(u.id===user.uid) row.classList.add('current');
    const roleLabel = u.role==='elder'?'Старший модер':u.role==='moderator'?'Модер':'Игрок';
    row.innerHTML=`<div class="rank">${u.displayPlace}</div><div class="nick">${u.nick||'Не указан'}</div><div class="points">${u.points}</div><div class="role">${roleLabel}</div>`;
    setTimeout(()=>row.classList.add('show'),index*50);
    board.appendChild(row);
  });
});
</script>
</body>
</html>
