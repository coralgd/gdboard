<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>GDBoard - Лидерборд</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<canvas id="hud-bg"></canvas>
<div class="panel" id="list"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { collection, query, orderBy, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async user => {
  if(!user) location.href="index.html";
  const me = (await getDoc(doc(db,"users",user.uid))).data();
  if(me.situation!=="verified") location.href="nick.html";

  const snap = await getDocs(query(collection(db,"users"), orderBy("points","desc")));

  let place = 0;
  let lastPoints = null;
  let realPlace = 0;

  snap.forEach(d=>{
    const u = d.data();
    realPlace++;
    if(u.points!==lastPoints){
      place = realPlace;
      lastPoints = u.points;
    }

    const row=document.createElement("div");
    row.className="row";

    let roleText="";
    if(u.role==="moderator") roleText="Модер";
    if(u.role==="elder") roleText="Старший модер";

    row.innerHTML=`
      <div>${place}</div>
      <div>${u.nick||"(no nick)"}</div>
      <div>${u.points}</div>
      <div>${roleText}</div>
    `;

    if(d.id===user.uid) row.style.color="#00d8ff";
    if(u.role==="elder") row.style.color="#ff5555";
    if(u.role==="moderator") row.style.color="#ffaa00";

    list.append(row);
  });
});
</script>
<script src="hudBackground.js"></script>
</body>
</html>
