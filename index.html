<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Вход / Регистрация</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB7QbVxGHR7Qm8o8Wzl_wxsCpzMUdS5rws",
  authDomain: "gdboard-add4a.firebaseapp.com",
  projectId: "gdboard-add4a",
  storageBucket: "gdboard-add4a.firebasestorage.app",
  messagingSenderId: "883125028740",
  appId: "1:883125028740:web:c504de4139943b8606bfd1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const regForm = document.getElementById("regForm");
const loginForm = document.getElementById("loginForm");

regForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = regForm.email.value;
  const password = regForm.password.value;
  const nick = regForm.nick.value;

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const uid = userCredential.user.uid;
    await setDoc(doc(db, "users", uid), {
      nick,
      points: 0,
      situation: "not requested",
      role: "player"
    });
    window.location.href = "nick.html";
  } catch (err) {
    alert("Ошибка регистрации: " + err.message);
  }
});

loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = loginForm.email.value;
  const password = loginForm.password.value;
  try {
    await signInWithEmailAndPassword(auth, email, password);
    window.location.href = "nick.html";
  } catch (err) {
    alert("Ошибка входа: " + err.message);
  }
});
</script>
</head>
<body>
<h1>Регистрация</h1>
<form id="regForm">
  <input name="nick" placeholder="Ник" required />
  <input name="email" type="email" placeholder="Email" required />
  <input name="password" type="password" placeholder="Пароль" required />
  <button>Зарегистрироваться</button>
</form>

<h1>Вход</h1>
<form id="loginForm">
  <input name="email" type="email" placeholder="Email" required />
  <input name="password" type="password" placeholder="Пароль" required />
  <button>Войти</button>
</form>
</body>
</html>
