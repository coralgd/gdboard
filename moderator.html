<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Moderator</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="app">
  <div class="panel">
    <h1>Панель модератора</h1>
    <div class="list" id="list"></div>
  </div>
</div>

<script src="hudBackground.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc, query, where } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyB7QbVxGHR7Qm8o8Wzl_wxsCpzMUdS5rws",
  authDomain: "gdboard-add4a.firebaseapp.com",
  projectId: "gdboard-add4a"
});

const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async user=>{
  if(!user) location.href="index.html";

  const me = (await getDocs(collection(db,"users"))).docs.find(d=>d.id===user.uid).data();
  if(me.role!=="moderator" && me.role!=="elder") location.href="main.html";

  const q = query(collection(db,"users"), where("situation","==","verified"));
  const snap = await getDocs(q);

  snap.forEach(d=>{
    const u=d.data();
    if(u.role!=="player") return;

    const r=document.createElement("div");
    r.className="row";
    r.innerHTML=`<div></div><div>${u.nick}</div><input id="p${d.id}" value="${u.points}"><button class="btn">OK</button>`;
    r.querySelector("button").onclick=()=>updateDoc(doc(db,"users",d.id),{points:+r.querySelector("input").value});
    list.appendChild(r);
  });
});
</script>
</body>
</html>
