<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Панель старшего модератора</title>
<style>
body{margin:0;padding:20px;font-family:'Orbitron',sans-serif;background:#0b0c10;color:#00f0ff;display:flex;flex-direction:column;align-items:center;}
h1{font-size:2.5em;text-shadow:0 0 10px #00f0ff;margin-bottom:25px;}
#usersList{width:95%;max-width:1000px;display:flex;flex-direction:column;gap:12px;}
.user-card{display:grid;grid-template-columns:3fr 2fr 2fr 2fr 2fr;padding:12px 15px;border-radius:10px;background:rgba(0,0,0,0.55);border:1px solid rgba(0,255,255,0.2);box-shadow:0 2px 10px rgba(0,255,255,0.2);transition:all 0.3s;opacity:0;transform:translateY(-20px);}
.user-card.show{opacity:1;transform:translateY(0);}
.user-card:hover{transform:translateY(-2px) scale(1.02);}
input.points-input{width:70%;padding:6px;border-radius:5px;border:none;background:#0b0c10;color:#00f0ff;outline:1px solid #00f0ff;}
button.action-btn{padding:6px 10px;border:none;border-radius:6px;background:#00a0ff;color:#000;font-weight:bold;cursor:pointer;transition:0.3s;margin-left:5px;}
button.action-btn:hover{background:#00f0ff;box-shadow:0 0 10px #00f0ff;color:#000;}
</style>
</head>
<body>
<h1>Панель старшего модератора</h1>
<div id="usersList"></div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, collection, doc, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {/* твой config */};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const usersList=document.getElementById('usersList');

onAuthStateChanged(auth, async user=>{
  if(!user) return window.location.href='index.html';
  const userSnap = await getDoc(doc(db,'users',user.uid));
  if(!userSnap.exists()) return window.location.href='index.html';
  const data=userSnap.data();
  if(data.role!=='elder') return window.location.href='main.html';

  const usersRef=collection(db,'users');
  const snapshot=await getDocs(usersRef);
  const usersArr=snapshot.docs.map(d=>({id:d.id,...d.data()}));

  usersArr.forEach((u,index)=>{
    const card=document.createElement('div');
    card.classList.add('user-card');
    setTimeout(()=>card.classList.add('show'),index*80);
    const isModer = u.role==='moderator';
    const isElder = u.role==='elder';
    card.innerHTML=`
      <div>${u.nick||'Не указан'}</div>
      <div><input type="number" class="points-input" value="${u.points||0}"></div>
      <div><button class="action-btn">${isModer||isElder?'Снять модерку':'Назначить модером'}</button></div>
      <div><button class="action-btn">${u.situation==='verified'?'Снять верификацию':'Верифицировать'}</button></div>
    `;

    // обработка кнопок
    const btnModer=card.querySelectorAll('.action-btn')[0];
    const btnVerif=card.querySelectorAll('.action-btn')[1];
    const input=card.querySelector('.points-input');

    btnModer.addEventListener('click', async ()=>{
      await updateDoc(doc(db,'users',u.id),{role: (isModer||isElder)?'player':'moderator'});
      btnModer.textContent=(isModer||isElder)?'Назначить модером':'Снять модерку';
    });
    btnVerif.addEventListener('click', async ()=>{
      await updateDoc(doc(db,'users',u.id),{situation:u.situation==='verified'?'not requested':'verified'});
      btnVerif.textContent=u.situation==='verified'?'Верифицировать':'Снять верификацию';
    });
  });
});
</script>
</body>
</html>
