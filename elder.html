<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Elder</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="app">
  <div class="panel">
    <h1>Старший модератор</h1>
    <div class="list" id="list"></div>
  </div>
</div>

<script src="hudBackground.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyB7QbVxGHR7Qm8o8Wzl_wxsCpzMUdS5rws",
  authDomain: "gdboard-add4a.firebaseapp.com",
  projectId: "gdboard-add4a"
});

const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async user=>{
  if(!user) location.href="index.html";

  const me = (await getDocs(collection(db,"users"))).docs.find(d=>d.id===user.uid).data();
  if(me.role!=="elder") location.href="main.html";

  const snap=await getDocs(collection(db,"users"));
  snap.forEach(d=>{
    const u=d.data();
    const r=document.createElement("div");
    r.className="row";
    r.innerHTML=`
      <div></div>
      <div>${u.nick||"—"}</div>
      <input value="${u.points||0}">
      <button class="btn">Баллы</button>
    `;
    r.querySelector("button").onclick=()=>updateDoc(doc(db,"users",d.id),{points:+r.querySelector("input").value});
    list.appendChild(r);
  });
});
</script>
</body>
</html>
