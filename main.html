<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<canvas id="hud-bg"></canvas>

<div class="panel">
  <h2>Главная</h2>
  <div class="row"><div>Ваш ник:</div><div id="nick"></div></div>
  <div class="row"><div>Баллы:</div><div id="points"></div></div>
  <div class="row"><div>Место:</div><div id="place"></div></div>
  <div class="row actions">
    <button id="leaderboardBtn">Лидерборд</button>
    <button id="checkBtn">Проверить</button>
    <p id="checkStatus" style="color:red"></p>
  </div>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async user => {
  if(!user) location.href="index.html";
  const ref = doc(db,"users",user.uid);
  const data = (await getDoc(ref)).data();

  if(data.situation!=="verified") location.href="nick.html";

  document.getElementById("nick").innerText = data.nick;
  document.getElementById("points").innerText = data.points;
  document.getElementById("place").innerText = data.place;

  document.getElementById("leaderboardBtn").onclick = ()=>location.href="leaderboard.html";

  document.getElementById("checkBtn").onclick = ()=>{
    if(data.role==="moderator"||data.role==="elder"){
      location.href=(data.role==="elder"?"elder.html":"moderator.html");
    }else{
      document.getElementById("checkStatus").innerText="Ошибка: модерки нет";
    }
  };
});
</script>
<script src="hudBackground.js"></script>
</body>
</html>
